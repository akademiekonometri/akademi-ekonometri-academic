---
title: "Zaman Serileri Analizi"
subtitle: "Hafta #3 - Uygulama"
author: "[Dr. Ömer Kara](<mailto:okara@ogu.edu.tr>)"
date: "`r format(Sys.time(), format = '%A, %B %d, %Y')`"
output:
  html_document:
    code_folding: show
    df_print: paged
    fig_caption: yes
    highlight: zenburn
    keep_md: no
    number_sections: yes
    theme: readable
    toc: yes
    toc_depth: 3
    toc_float:
      collapsed: yes
      smooth_scroll: yes
  pdf_document:
    fig_caption: yes
    highlight: zenburn
    toc: yes
    number_sections: yes
editor_options: 
  chunk_output_type: inline
---

<!-- HTML CSS Ayarlaması -->
```{=html}
<style type="text/css">
div.main-container {
    width: 100%;
    max-width: unset;
}
</style>
```
<!-- HTML CSS Ayarlaması -->

```{r Settings.Code.Chunk, include = FALSE, purl = FALSE}
# Değiştirmeyin.
knitr::opts_chunk$set(cache = TRUE, collapse = TRUE, comment = "#>", echo = TRUE, engine = "R", error = FALSE, eval = TRUE, fig.align = "center", fig.height = 5, fig.width = 7, out.width = "100%", highlight = TRUE, include = TRUE, message = TRUE, prompt = FALSE, purl = TRUE, results = "markup", rows.print = 5, strip.white = TRUE, tidy = FALSE, tidy.opts = list(width.cutoff = 80), warning = TRUE)
```
```{r Settings.Mirros, include = FALSE, purl = FALSE, cache = TRUE}
# Değiştirmeyin.
r <- getOption("repos")
r["CRAN"] <- "https://cloud.r-project.org/"
options(repos = r)
```
```{r Settings.Functions, include = FALSE, cache = TRUE}
# Değiştirmeyin.

```

----

**Önemli Notlar**  

- Yanında **Değiştirmeyin** ibaresi bulunan hiçbir kodu ve/veya satırı değiştirmeyin.
- Yazılardakı ve kodlardaki açıklamaları dikkatlice okuyun.
- Kodların sırasını **mümkün olduğunca** değiştirmeyin. Aksi taktirde hata ile karşılaşabilirsiniz.
- [Paketler](#Packages) bölümünde, gerekli [R paketlerini](https://cran.r-project.org/web/packages/available_packages_by_name.html) [`okara`](https://github.com/omerkara/okara) paketindeki `Load.Install` fonksiyonunu kullanarak indirin ve yükleyin.
- [Seed](#Seed) bölümünde, istediğiniz sayıyı kullanabilirsiniz. Rassal olarak seçilen değerler, eğer varsa, seçtiğiniz sayıya göre değişecektir.
- R hakkında daha fazla bilgi için, benim yazdığım [R mini BootCamp](https://akademiekonometri.bitbucket.io/R_mini_BootCamp/R_mini_BootCamp.html) adlı İngilizce kaynaktan faydalanabilirsiniz.

---

# Hazırlık {#Preparation}
## Paketler {#Settings.Packages}
- [R paketlerini](https://cran.r-project.org/web/packages/available_packages_by_name.html) [`okara`](https://github.com/omerkara/okara) paketindeki `Load.Install` fonksiyonunu kullanarak indirin ve/veya yükleyin.
```{r Settings.Packages, cache = TRUE}
# Devtools ve okara paketlerinin yüklenmesi.
if("devtools" %in% rownames(utils::installed.packages()) == FALSE) {suppressWarnings(suppressMessages(install.packages("devtools")))}
suppressWarnings(suppressMessages(library("devtools"))) ## devtools paketi, okara paketinin yüklenmesi için gereklidir.
if("okara" %in% rownames(utils::installed.packages()) == FALSE) {suppressWarnings(suppressMessages(devtools::install_github("omerkara/okara", force = FALSE)))}
suppressWarnings(suppressMessages(library("okara"))) ## okara paketi.

# Gerekli paketlerin yüklenmesi.
Load.Install(c("rstudioapi", "readxl", "plyr", "dplyr", "tidyr", "stringr", "stringi", "Hmisc", "reshape2", "scales", "lubridate", "ggplot2", "xtable", "DT", "latex2exp", "forecast", "WDI", "fpp2", "fpp3", "datasets", "quantmod", "FinYang/tsdl", "ggseas", "slider", "ecm", "wooldridge", "dynlm", "car", "AER", "stargazer"))
```

## Seed {#Settings.Seed}
- Aşağıdaki `R kodu` bölümünde istediğiniz sayıyı girebilirsiniz.
```{r Settings.Seed}
set.seed(1234)
```

## Çalışma Klasörü {#Settings.Working.Directory}
- Aşağıdaki `R kodu`, R çalışma klasörünü (yani working directory) sadece bu dosya için, bu dosyanın bilgisayarınızda bulunan lokasyonunda belirliyor.
    + `getwd()` fonksiyonunu kullanarak mevcut çalışma klasörünün hangi lokasyonda belirlendiğine bakabilirsiniz.
```{r Settings.Working.Directory}
# Değiştirmeyin.
main.path <- dirname(rstudioapi::getActiveDocumentContext()$path) ## Bu kod otomatik olarak kaynak dosyasının, yani üzerinde çalıştığınız dosyanın, bilgisayarınızda hangi lokasyonda olduğunu buluyor.
setwd(paste0(main.path)) ## Yeni çalışma klasörü (yani working directory) bu kaynak dosyasının lokasyonunda belirleniyor.
```

----

# Hatırlatma {#ReCall}
- Bu alt bölümde, daha önceden bahsedilen bazı konular kısaca hatırlatılmıştır.

## Data Yükleme {#ReCall.Data}
- Bu modellerin uygulaması için R paketlerinden direkt olarak veri indirip yüklemeye çalışalım.
- R paketlerinin içinde olan verileri toplu olarak görmek için [Vincent Arel-Bundock](http://arelbundock.com/) tarafından hazırlanan [web sitesini](https://vincentarelbundock.github.io/Rdatasets/articles/data.html) inceleyebilirsiniz.
- [`wooldridge`](https://cran.r-project.org/web/packages/wooldridge/index.html) R paketindeki verileri incelemek için [wooldridge CRAN klavuzuna](https://cran.r-project.org/web/packages/wooldridge/wooldridge.pdf) bakabilirsiniz.
    + Bu verilerin daha detaylı bir gösterimi ve uygulama için ise [bu linke](https://justinmshea.github.io/wooldridge/index.html) bakabilirsiniz.
- R paketlerinde mevcut olan veriyi, verinin ismini kullanarak yüklemek için 1 fonksiyon kullanacağız: `data`.
    + `data` fonksiyonu ile istediğimiz veriyi verinin R paketi içindeki ismini kullanarak direkt olarak R'ın içine yükleyebiliriz.
- Ayrıca, yüklediğimiz veri hakkında daha fazla bilgiye sahip olmak için, yani metadatasına ulaşmak için, `?` kodunu kullanabiliriz. Örneğin, `wooldridge` R paketindeki `wage1` datası için:
    + `wage1` verisini `data(wage1)` kodunu kullanarak yüklediğimizi var sayalım.
    + Daha sonra `?wage1` kodunu kullanarak bu veri hakkındaki tüm bilgilere **RStudio üzerindeki help sekmesinden** ulaşabiliriz.

## Statik Model {#ReCall.Static.Models}
- Statik modeller ile bağımlı değişken $y_{t}$ ve bağımsız değişkenler $x_{t}$ arasındaki **eşanlı ödünümü** inceleyebiliriz.
- Statik modellerin tahmini için temel olarak 1 fonksiyon kullanacağız: `lm`.
    + `lm` fonksiyonu ile formunu belirlediğimiz basit doğrusal regresyon ya da çoklu doğrusal regresyon modellerini kolayca tahmin edebiliriz.

## FDL Modeli {#ReCall.FDL.Models}
- FDL modelleri ile **etki çarpanı** ve **uzun dönem çarpanı** değerlerini hesaplayabiliriz.
- FDL modellerinin tahmini için temel olarak 1 fonksiyon kullanacağız: `dynlm`.
    + `dynlm` fonksiyonu ile formunu belirlediğimiz FDL modellerini kolayca tahmin edebiliriz.
    + `dynlm` fonksiyonunun kullanımı `lm` fonksiyonuna çok benzerdir. Fakat ek olarak, gecikmeli değişkenlerin kullanımı için ekstra kodlar kullanmaya izin verir.
    + `dynlm` fonksiyonunda sadece zaman serisi verisi kullanılabilir. Bu nedenle, elinizdeki verinin zaman serisi objesi olması şarttır. Bu amaçla biz, elimizdeki veriyi zaman serisi objesine çevirmek için `ts` fonksiyonunu kullanacağız.

# Zaman Serisi Modeli: Çıkarsama {#Time.Series.Models.Inference}
- Bu alt bölümde, zaman serileri modellerinde çıkarsama konusu **iki basit zaman serisi modeli** kullanılarak uygulamalı olarak gösterilecektir.
    + Statik Modeller
    + Sonlu Dağıtılmış Gecikme Modelleri (Finite Distributed Lag Models) - FDL Modelleri

## $t$-testi {#t.test}
- Basit zaman serisi modellerinde $t$-testi uygulamak için 3 farklı fonksiyon kullanabiliriz.
    + `pt` fonksiyonu ile model tahmininden elde ettiğimiz $t$-istatistiğine ait $p$-değerini çift ve tek kuyruklu hipotez testleri için hesaplayabiliriz.
    + [`okara`](https://github.com/omerkara/okara) R paketindeki `hoCoef` fonksiyonunda model tahminini kullanarak çift ve tek kuyruklu hipotez testleri uygulayabiliriz.
    + [`car`](https://cran.r-project.org/web/packages/car/index.html) R paketindeki `linearHypothesis` fonksiyonunda model tahminini kullanarak çift kuyruk hipotez testini uygulayabiliriz.

### Örnek: 1 {#t.test.Example.1}
- Örnek olarak, `wooldridge` R paketinden `phillips` verisini yükleyelim.
- `phillips` verisi genel olarak Amerika'daki **enflasyon ve işsizlik** değişkenlerini, ve ayrıca bu değişkenlere ait gecikme ve ilk farklar değerlerini yıllık olarak içeriyor. Örneğimizi basitleştirmek için biz sadece bazı değişkenleri kullanacağız.
    + inf ($inf_{t}$): cari dönem enflasyon oranı
    + unem ($unem_{t}$): cari dönem işsizlik oranı
- Sonra yüklediğimiz bu verinin metadatasını ve yapısını inceleyelim.
- Daha sonra yüklediğimiz veriyi kullanarak aşağıdaki statik modeli tahmin edelim.
    + Model (Statik): $inf_{t} = \beta_{0} + \beta_{1}unem_{t} + u_{t}$
- Son olarak model tahminini kullanarak aşağıdaki hipotezleri farklı fonksiyonlarla test edelim.
    + Hipotez Testi 1 (Çift Kuyruk $t$-testi): $H_{0}: \beta_{1} = 0 \;\; \text{vs.} \;\; H_{1}: \beta_{1} \neq 0$
    + Hipotez Testi 2 (Sol Kuyruk $t$-testi): $H_{0}: \beta_{1} = 0 \;\; \text{vs.} \;\; H_{1}: \beta_{1} < 0$
    + Hipotez Testi 3 (Sağ Kuyruk $t$-testi): $H_{0}: \beta_{1} = 0 \;\; \text{vs.} \;\; H_{1}: \beta_{1} > 0$
```{r t.test.Example.1}
data(phillips) ## Datayı yüklüyoruz.
?phillips ## Datanın metadatası.

data <- phillips ## Yüklediğimiz datayı "data" ismi ile kaydediyoruz.
str(data) ## Datanın yapısını inceleyelim.
data ## Datanın yapısını inceleyelim.

# Cari dönemde enflasyon ve işsizlik arasındaki statik model.
model <- lm(data = data, formula = inf ~ unem, singular.ok = FALSE)
summary(model) ## Tahmin özeti.

# Parametre tahminleri, standart hataları, t-istatistikleri ve p-değerleri.
coef(summary(model))

# pt fonksiyonu ile çift ve tek kuyruklu t-testi. Hesaplanan p-değeridir.
2*pt(q = abs(coef(summary(model))[2, 3]), df = model$df.residual, lower.tail = FALSE) ## Çift kuyruklu t-testi: H0: Beta1 = 0 vs H1: Beta1 != 0
pt(q = coef(summary(model))[2, 3], df = model$df.residual, lower.tail = TRUE) ## Sol kuyruk t-testi: H0: Beta1 = 0 vs H1: Beta1 < 0
pt(q = coef(summary(model))[2, 3], df = model$df.residual, lower.tail = FALSE) ## Sağ kuyruklu t-testi: H0: Beta1 = 0 vs H1: Beta1 > 0

# hoCoef fonksiyonu ile çift ve tek kuyruklu t-testi.
hoCoef(model, term = 2, bo = 0, alt = c("two.sided")) ## Çift kuyruklu t-testi: H0: Beta1 = 0 vs H1: Beta1 != 0 
hoCoef(model, term = 2, bo = 0, alt = c("less")) ## Sol kuyruk t-testi: H0: Beta1 = 0 vs H1: Beta1 < 0
hoCoef(model, term = 2, bo = 0, alt = c("greater")) ## Sağ kuyruklu t-testi: H0: Beta1 = 0 vs H1: Beta1 > 0

# linearHypothesis fonksiyonu ile çift kuyruklu t-testi.
linearHypothesis(model, c("unem = 0")) ## linearHypothesis fonksiyonu F-istatistiği ve ona ait p-değerini veriyor. Tek bir kısıt için hesaplanan F-istatistiğinin, aynı tek kısıt için hesaplanan t-istatistiğinin karesine eşit olduğunu unutmayın (ayrıca her iki testin sonucu da aynıdır).
```

### Örnek: 2 {#t.test.Example.2}
- Örnek olarak, `wooldridge` R paketinden `intdef` verisini yükleyelim.
- `intdef` verisi genel olarak Amerika'daki **faiz oranı, enflasyon ve bütçe açığı** değişkenlerini, ve ayrıca bu değişkenlere ait gecikme ve ilk farklar değerlerini yıllık olarak içeriyor. Örneğimizi basitleştirmek için biz sadece bazı değişkenleri kullanacağız.
    + i3 ($i3_{t}$): cari dönem 3 aylık devlet tahvili faiz oranı
    + inf ($inf_{t}$): cari dönem enflasyon oranı
    + def ($def_{t}$): cari dönem bütçe açığı (GSYH'ya oran olarak)
- Sonra yüklediğimiz bu verinin metadatasını ve yapısını inceleyelim.
- Daha sonra yüklediğimiz veriyi kullanarak aşağıdaki statik modeli tahmin edelim.
    + Model (Statik): $i3_{t} = \beta_{0} + \beta_{1}inf_{t} + \beta_{2}def_{t} + u_{t}$
- Son olarak model tahminini kullanarak aşağıdaki hipotezleri farklı fonksiyonlarla test edelim.
    + Hipotez Testi 1 (Çift Kuyruk $t$-testi): $H_{0}: \beta_{2} = 0 \;\; \text{vs.} \;\; H_{1}: \beta_{2} \neq 0$
    + Hipotez Testi 2 (Sol Kuyruk $t$-testi): $H_{0}: \beta_{2} = 0 \;\; \text{vs.} \;\; H_{1}: \beta_{2} < 0$
    + Hipotez Testi 3 (Sağ Kuyruk $t$-testi): $H_{0}: \beta_{2} = 0 \;\; \text{vs.} \;\; H_{1}: \beta_{2} > 0$
```{r t.test.Example.2}
data(intdef) ## Datayı yüklüyoruz.
?intdef ## Datanın metadatası.

data <- intdef ## Yüklediğimiz datayı "data" ismi ile kaydediyoruz.
str(data) ## Datanın yapısını inceleyelim.
data ## Datanın yapısını inceleyelim.

# Cari dönemde faiz, enflasyon ve bütçe açığı arasındaki statik model.
model <- lm(data = data, formula = i3 ~ inf + def, singular.ok = FALSE)
summary(model) ## Tahmin özeti.

# Parametre tahminleri, standart hataları, t-istatistikleri ve p-değerleri.
coef(summary(model))

# pt fonksiyonu ile çift ve tek kuyruklu t-testi. Hesaplanan p-değeridir.
2*pt(q = abs(coef(summary(model))[3, 3]), df = model$df.residual, lower.tail = FALSE) ## Çift kuyruklu t-testi: H0: Beta2 = 0 vs H1: Beta2 != 0 
pt(q = coef(summary(model))[3, 3], df = model$df.residual, lower.tail = TRUE) ## Sol kuyruk t-testi: H0: Beta2 = 0 vs H1: Beta2 < 0
pt(q = coef(summary(model))[3, 3], df = model$df.residual, lower.tail = FALSE) ## Sağ kuyruklu t-testi: H0: Beta2 = 0 vs H1: Beta2 > 0

# hoCoef fonksiyonu ile çift ve tek kuyruklu t-testi.
hoCoef(model, term = 3, bo = 0, alt = c("two.sided")) ## Çift kuyruklu t-testi: H0: Beta2 = 0 vs H1: Beta2 != 0 
hoCoef(model, term = 3, bo = 0, alt = c("less")) ## Sol kuyruk t-testi: H0: Beta2 = 0 vs H1: Beta2 < 0
hoCoef(model, term = 3, bo = 0, alt = c("greater")) ## Sağ kuyruklu t-testi: H0: Beta2 = 0 vs H1: Beta2 > 0

# linearHypothesis fonksiyonu ile çift kuyruklu t-testi.
linearHypothesis(model, c("def = 0")) ## linearHypothesis fonksiyonu F-istatistiği ve ona ait p-değerini veriyor. Tek bir kısıt için hesaplanan F-istatistiğinin, aynı tek kısıt için hesaplanan t-istatistiğinin karesine eşit olduğunu unutmayın (ayrıca her iki testin sonucu da aynıdır).
```

## $F$-testi {#F.test}
- Basit zaman serisi modellerinde $F$-testi uygulamak için 2 farklı fonksiyon kullanabiliriz.
    + `pf` fonksiyonu ile model tahmininden elde ettiğimiz $f$-istatistiğine ait $p$-değerini sadece modelin genel anlamlılığını test eden hipotez testi için hesaplayabiliriz.
    + [`car`](https://cran.r-project.org/web/packages/car/index.html) R paketindeki `linearHypothesis` fonksiyonunda model tahminini kullanarak birçok farklı çoklu kısıt için hipotez testi uygulayabiliriz.

### Örnek: 1 {#F.test.Example.1}
- Örnek olarak, `wooldridge` R paketinden `phillips` verisini yükleyelim.
- `phillips` verisi genel olarak Amerika'daki **enflasyon ve işsizlik** değişkenlerini, ve ayrıca bu değişkenlere ait gecikme ve ilk farklar değerlerini yıllık olarak içeriyor. Örneğimizi basitleştirmek için biz sadece bazı değişkenleri kullanacağız.
    + inf ($inf_{t}$): cari dönem enflasyon oranı
    + unem ($unem_{t}$): cari dönem işsizlik oranı
- Daha sonra yüklediğimiz veriyi kullanarak aşağıdaki FDL$_{(2)}$ modelini tahmin edelim.
    + Model (FDL$_{(2)}$): $inf_{t} = \alpha_{0} + \delta_{0}unem_{t} + \delta_{1}unem_{t-1} + \delta_{2}unem_{t-2} + u_{t}$
- Son olarak model tahminini kullanarak aşağıdaki hipotezleri farklı fonksiyonlarla test edelim.
    + Modelin istatistiki olarak genel anlamlılığının testi.
        * Hipotez Testi 1 ($F$-testi): $H_{0}: \delta_{0} = \delta_{1} = \delta_{2} = 0 \;\; \text{vs.} \;\; H_{1}: H_{0} \ \text{doğru değil}$
    + Tüm gecikmeli değişken parametrelerinin birlikte istatistiki olarak anlamlı olup olmadığının testi.
        * Hipotez Testi 2 ($F$-testi): $H_{0}: \delta_{1} = \delta_{2} = 0 \;\; \text{vs.} \;\; H_{1}: H_{0} \ \text{doğru değil}$
        * Eğer boş hipotez reddedilirse, FDL$_{(2)}$ modeline ihtiyaç vardır. Aksi durumda statik model kullanılmalıdır.
```{r F.test.Example.1}
data(phillips) ## Datayı yüklüyoruz.
?phillips ## Datanın metadatası.

data <- phillips ## Yüklediğimiz datayı "data" ismi ile kaydediyoruz.
data.ts <- ts(data, start = 1948) ## Data 1948 yılından itibaren başlamış.

# Model: Enflasyon ve işsizlik arasındaki FDL(2) modeli.
model <- dynlm(data = data.ts, formula = inf ~ unem + L(unem, 1) + L(unem, 2), singular.ok = FALSE)
summary(model) ## Tahmin özeti.

# Modelin istatistiki olarak genel anlamlılığı için F-testi ve serbestlik dereceleri.
summary(model)$fstatistic

# Hipotez Testi 1: pf fonksiyonu ile modelin istatistiki olarak genel anlamlılığının testi. Hesaplanan p-değeridir.
pf(q = summary(model)$fstatistic[1], df1 = summary(model)$fstatistic[2], df2 = summary(model)$fstatistic[3], lower.tail = FALSE)

# Hipotez Testi 1: linearHypothesis fonksiyonu ile modelin istatistiki olarak genel anlamlılığının testi.
linearHypothesis(model, c("unem = 0", "L(unem, 1) = 0", "L(unem, 2) = 0"))

# Hipotez Testi 2: linearHypothesis fonksiyonu ile tüm gecikmeli değişken parametrelerinin birlikte istatistiki olarak anlamlı olup olmadığının testi.
linearHypothesis(model, c("L(unem, 1) = 0", "L(unem, 2) = 0")) ## p-değeri %5 anlamlılık düzeyinden büyük olduğundan boş hipotez reddedilemez ve statik model kullanılmalıdır.
```

### Örnek: 2 {#F.test.Example.2}
- Örnek olarak, `wooldridge` R paketinden `fertil3` verisini yükleyelim.
- `fertil3` verisi genel olarak Amerika'daki **doğurganlık ve vergi muafiyeti** değişkenlerini, ve ayrıca bu değişkenlere ait gecikme ve ilk farklar değerlerini yıllık olarak içeriyor. Örneğimizi basitleştirmek için biz sadece bazı değişkenleri kullanacağız.
    + gfr ($gfr_{t}$): doğurganlık oranı (doğurganlık yaşındaki 1000 kadına düşen bebek sayısı)
    + pe ($pe_{t}$): çocuk sahibi olmayı özendirmek için getirilen vergi muafiyeti ($)
- Sonra yüklediğimiz bu verinin metadatasını ve yapısını inceleyelim.
- Daha sonra yüklediğimiz veriyi kullanarak aşağıdaki FDL$_{(3)}$ modelini tahmin edelim.
    + Model (FDL$_{(3)}$): $gfr_{t} = \alpha_{0} + \delta_{0}pe_{t} + \delta_{1}pe_{t-1} + \delta_{2}pe_{t-2} + \delta_{3}pe_{t-3} + u_{t}$
- Son olarak model tahminini kullanarak aşağıdaki hipotezleri farklı fonksiyonlarla test edelim.
    + Modelin istatistiki olarak genel anlamlılığının testi.
        * Hipotez Testi 1 ($F$-testi): $H_{0}: \delta_{0} = \delta_{1} = \delta_{2} = \delta_{3} = 0 \;\; \text{vs.} \;\; H_{1}: H_{0} \ \text{doğru değil}$
    + İkinci ve üçüncü gecikmeli değişken parametrelerinin birlikte istatistiki olarak anlamlı olup olmadığının testi.
        * Hipotez Testi 2 ($F$-testi): $H_{0}: \delta_{2} = \delta_{3} = 0 \;\; \text{vs.} \;\; H_{1}: H_{0} \ \text{doğru değil}$
    + Tüm gecikmeli değişken parametrelerinin birlikte istatistiki olarak anlamlı olup olmadığının testi.
        * Hipotez Testi 3 ($F$-testi): $H_{0}: \delta_{1} = \delta_{2} = \delta_{3} = 0 \;\; \text{vs.} \;\; H_{1}: H_{0} \ \text{doğru değil}$
        * Eğer boş hipotez reddedilirse, FDL$_{(3)}$ modeline ihtiyaç vardır. Aksi durumda statik model kullanılmalıdır.
```{r F.test.Example.2}
data(fertil3) ## Datayı yüklüyoruz.
?fertil3 ## Datanın metadatası.

data <- fertil3 ## Yüklediğimiz datayı "data" ismi ile kaydediyoruz.
str(data) ## Datanın yapısını inceleyelim.
data ## Datanın yapısını inceleyelim.
data.ts <- ts(data, start = 1913) ## Data 1913 yılından itibaren başlamış.

# Model : Vergi muafiyeti ve doğurganlık arasındaki FDL(3) modeli.
model <- dynlm(data = data.ts, formula = gfr ~ pe + L(pe, 1) + L(pe, 2) + L(pe, 3), singular.ok = FALSE)
summary(model) ## Tahmin özeti.

# Modelin istatistiki olarak genel anlamlılığı için F-testi ve serbestlik dereceleri.
summary(model)$fstatistic

# Hipotez Testi 1: pf fonksiyonu ile modelin istatistiki olarak genel anlamlılığının testi. Hesaplanan p-değeridir.
pf(q = summary(model)$fstatistic[1], df1 = summary(model)$fstatistic[2], df2 = summary(model)$fstatistic[3], lower.tail = FALSE)

# Hipotez Testi 1: linearHypothesis fonksiyonu ile modelin istatistiki olarak genel anlamlılığının testi.
linearHypothesis(model, c("pe = 0", "L(pe, 1) = 0", "L(pe, 2) = 0", "L(pe, 3) = 0"))

# Hipotez Testi 2: linearHypothesis fonksiyonu ile 2. ve 3. gecikmeli değişken parametrelerinin birlikte istatistiki olarak anlamlı olup olmadığının testi.
linearHypothesis(model, c("L(pe, 2) = 0", "L(pe, 3) = 0")) ## p-değeri %5 anlamlılık düzeyinden büyük olduğundan boş hipotez reddedilemez ve bu nedenle 2. ve 3. gecikmeli değişkenler modelde kullanılmamalıdır.

# Hipotez Testi 3: linearHypothesis fonksiyonu ile tüm gecikmeli değişken parametrelerinin birlikte istatistiki olarak anlamlı olup olmadığının testi.
linearHypothesis(model, c("L(pe, 1) = 0", "L(pe, 2) = 0", "L(pe, 3) = 0")) ## p-değeri %5 anlamlılık düzeyinden büyük olduğundan boş hipotez reddedilemez ve statik model kullanılmalıdır.
```

# Fonksiyonel Form {#Functional.Form}
- Bu alt bölümde önce, yatay-kesit analizinde gördüğümüz fonksiyonel formlar ve parametre yorumlamaları statik zaman serisi modeli kullanılarak hatırlatılacaktır.
    + Düzey-Düzey Fonksiyonel Formu: $y_{t} = \beta_{0} + \beta_{1}x_{t} + u_{t} \quad \longrightarrow \quad \Delta{y_{t}} = \beta_{1}\Delta{x_{t}}$  
    ceteris paribus koşulu altında, bağımsız değişken $x$'deki 1 birimlik artış, bağımlı değişken $y$'de ortalamada $\beta_{1}$ birim kadar değişime neden olur.
    + Düzey-Log Fonksiyonel Formu: $y_{t} = \beta_{0} + \beta_{1}\ln{x_{t}} + u_{t} \quad \longrightarrow \quad \Delta{y_{t}} = (\beta_{1}/100) \%\Delta{x_{t}}$  
    ceteris paribus koşulu altında, bağımsız değişken $x$'deki \%1'lik artış, bağımlı değişken $y$'de ortalamada $\beta_{1}/100$ birim kadar değişime neden olur.
    + Düzey-Düzey Fonksiyonel Formu: $\ln{y_{t}} = \beta_{0} + \beta_{1}x_{t} + u_{t} \quad \longrightarrow \quad \%\Delta{y_{t}} = (100\beta_{1})\Delta{x_{t}}$  
    ceteris paribus koşulu altında, bağımsız değişken $x$'deki 1 birimlik artış, bağımlı değişken $y$'de ortalamada $\%100\beta_{1}$ kadar değişime neden olur. $100\beta_{1}$ bazen $y$'nin $x$'e göre yarı-esnekliği olarak da adlandırılır.
    + Düzey-Düzey Fonksiyonel Formu: $\ln{y_{t}} = \beta_{0} + \beta_{1}\ln{x_{t}} + u_{t} \quad \longrightarrow \quad \%\Delta{y_{t}} = \beta_{1}\%\Delta{x_{t}}$  
    ceteris paribus koşulu altında, bağımsız değişken $x$'deki \%1'lik artış, bağımlı değişken $y$'de ortalamada $\%\beta_{1}$ kadar değişime neden olur. $\beta_{1}$ bazen $y$'nin $x$'e göre esnekliği olarak da adlandırılır.
- Daha sonra, farklı fonksiyonel formların kullanıldığı zaman serileri modellerinde çıkarsama konusu **iki basit zaman serisi modeli** kullanılarak uygulamalı olarak gösterilecektir.
    + Statik Modeller
    + Sonlu Dağıtılmış Gecikme Modelleri (Finite Distributed Lag Models) - FDL Modelleri

## Örnek: 1 {#Functional.Form.Example.1}
- Örnek olarak, `wooldridge` R paketinden `prminwge` verisini yükleyelim.
- `prminwge` verisi genel olarak Amerika ve Porto Riko'daki **istihdam, asgari ücret ve GSMH** değişkenlerini, ve ayrıca bu değişkenlere ait logatikmik ve gecikme değerlerini yıllık olarak içeriyor. Örneğimizi basitleştirmek için biz sadece bazı değişkenleri kullanacağız.
    + prepop ($prepop_{t}$): Porto Riko'daki istihdam oranı
    + mincov ($mincov_{t}$): asgari ücretin ortalama ücrete göre göreceli önemi
        * Asgari ücretin ortalama ücrete göre göreceli önemini belirten $mincov$ değişkeni şu şekilde hesaplanmıştır.
			$$\frac{avgmin}{avgwage} \times avgcov$$
			burada $avgmin$: ortalama asgari ücret; $avgwage$: ortalama ücret; $avgcov$: asgari ücret yasasından faydalanan çalışanların oranıdır.
    + usgnp ($usgnp_{t}$): Amerika için Gayri Safi Milli Hasıla (GSMH)
- Sonra yüklediğimiz bu verinin metadatasını ve yapısını inceleyelim.
- Daha sonra yüklediğimiz veriyi kullanarak Amerika'daki asgari ücretin Porto Riko'daki istihdam üzerindeki etkisini araştıran Log-Log fonksiyonel formundaki statik modeli tahmin edelim.
    + Model (Statik): $\ln(prepop_{t}) = \beta_{0} + \beta_{1}\ln(mincov_{t}) + \beta_{2}\ln(usgnp_{t}) + u_{t}$
- Son olarak model tahminini kullanarak aşağıdaki hipotezleri [`car`](https://cran.r-project.org/web/packages/car/index.html) R paketindeki `linearHypothesis` fonksiyonuyla test edelim.
    + Hipotez Testi 1 (Çift Kuyruk $t$-testi): $H_{0}: \beta_{1} = 0 \;\; \text{vs.} \;\; H_{1}: \beta_{1} \neq 0$
    + Hipotez Testi 2 (Çift Kuyruk $t$-testi): $H_{0}: \beta_{2} = 0 \;\; \text{vs.} \;\; H_{1}: \beta_{2} \neq 0$
```{r Functional.Form.Example.1}
data(prminwge) ## Datayı yüklüyoruz.
?prminwge ## Datanın metadatası.

data <- prminwge ## Yüklediğimiz datayı "data" ismi ile kaydediyoruz.
str(data) ## Datanın yapısını inceleyelim.
data ## Datanın yapısını inceleyelim.

# Amerika'daki asgari ücretin Porto Riko'daki istihdam üzerindeki etkisini araştıran statik model.
model <- lm(data = data, formula = log(prepop) ~ log(mincov) + log(usgnp), singular.ok = FALSE)
summary(model) ## Tahmin özeti.

# linearHypothesis fonksiyonu ile Beta1 için çift kuyruklu t-testi.
linearHypothesis(model, c("log(mincov) = 0")) ## linearHypothesis fonksiyonu F-istatistiği ve ona ait p-değerini veriyor. Tek bir kısıt için hesaplanan F-istatistiğinin, aynı tek kısıt için hesaplanan t-istatistiğinin karesine eşit olduğunu unutmayın (ayrıca her iki testin sonucu da aynıdır).

# linearHypothesis fonksiyonu ile Beta2 için çift kuyruklu t-testi.
linearHypothesis(model, c("log(usgnp) = 0")) ## linearHypothesis fonksiyonu F-istatistiği ve ona ait p-değerini veriyor. Tek bir kısıt için hesaplanan F-istatistiğinin, aynı tek kısıt için hesaplanan t-istatistiğinin karesine eşit olduğunu unutmayın (ayrıca her iki testin sonucu da aynıdır).
```

## Örnek: 2 {#Functional.Form.Example.2}
- Örnek olarak, [`AER`](https://cran.r-project.org/web/packages/AER/index.html) R paketinden `USMoney` verisini yükleyelim.
- `USMoney` verisi genel olarak Amerika'daki **para arzı ve GSMH** değişkenlerini çeyreklik olarak içeriyor. Örneğimizi basitleştirmek için biz sadece bazı değişkenleri kullanacağız.
    + m1 ($m1_{t}$): Para Arzı (Para Stoğu M1)
    + gnp ($gnp_{t}$): Nominal Gayri Safi Milli Hasıla (GSMH)
- Sonra yüklediğimiz bu verinin metadatasını ve yapısını inceleyelim.
- Daha sonra yüklediğimiz veriyi kullanarak GSMH'nin para arzı üzerindeki etkisini araştıran Log-Log fonksiyonel formundaki FDL$_{(4)}$ modelini tahmin edelim.
    + Model (FDL$_{(4)}$): $\ln(m1_{t}) = \alpha_{0} + \delta_{0}\ln(gnp_{t}) + \delta_{1}\ln(gnp_{t-1}) + \delta_{2}\ln(gnp_{t-2}) + \delta_{3}\ln(gnp_{t-3}) + \delta_{4}\ln(gnp_{t-4}) + u_{t}$
- Daha sonra model tahminini kullanarak etki çarpanı ve uzun dönem çarpanı değerlerini hesaplayalım.
    + Etki çarpanı (kısa dönem esnekliği): $\hat{\delta}_{0}$
    + Uzun dönem çarpanı (uzun dönem esnekliği): $\hat{\delta}_{0} + \hat{\delta}_{1} + \hat{\delta}_{2} + \hat{\delta}_{3} + \hat{\delta}_{4}$
- Son olarak model tahminini kullanarak aşağıdaki hipotezleri
[`car`](https://cran.r-project.org/web/packages/car/index.html) R paketindeki `linearHypothesis` fonksiyonuyla test edelim.
    + Modelin istatistiki olarak genel anlamlılığının testi.
        * Hipotez Testi 1 ($F$-testi): $H_{0}: \delta_{0} = \delta_{1} = \delta_{2} = \delta_{3} = \delta_{4} = 0 \;\; \text{vs.} \;\; H_{1}: H_{0} \ \text{doğru değil}$
    + Tüm gecikmeli değişken parametrelerinin birlikte istatistiki olarak anlamlı olup olmadığının testi.
        * Hipotez Testi 2 ($F$-testi): $H_{0}: \delta_{1} = \delta_{2} = \delta_{3} = \delta_{4} = 0 \;\; \text{vs.} \;\; H_{1}: H_{0} \ \text{doğru değil}$
        * Eğer boş hipotez reddedilirse, FDL$_{(4)}$ modeline ihtiyaç vardır. Aksi durumda statik model kullanılmalıdır.
```{r Functional.Form.Example.2.1}
data(USMoney) ## Datayı yüklüyoruz.
?USMoney ## Datanın metadatası.

data.ts <- USMoney ## Yüklediğimiz datayı "data" ismi ile kaydediyoruz. Yüklediğimiz datanın ts yani zaman serisi objesi olduğunu unutmayın.
str(data.ts) ## Datanın yapısını inceleyelim.
head(data.ts, 5) ## Datanın yapısını ts objesi olarak inceleyelim.
datatable(data.frame(Date = as.Date(date_decimal(as.numeric(time(data.ts)))), as.matrix(data.ts), stringsAsFactors = FALSE), filter = "none", options = list(pageLength = 5, autoWidth = TRUE)) ## Datanın yapısını data frame olarak inceleyelim.
```
```{r Functional.Form.Example.2.2}
# Amerika'daki GSMH'nin para arzı üzerindeki etkisini araştıran FDL(4) modeli.
model <- dynlm(data = data.ts, formula = log(m1) ~ log(gnp) + L(log(gnp), 1) + L(log(gnp), 2) + L(log(gnp), 3) + L(log(gnp), 4), singular.ok = FALSE)
summary(model) ## Tahmin özeti.

# Parametre isimleri daha sonra kullanılmak üzere kaydediliyor.
coef.names <- names(coef(model))

# Etki çarpanının (kısa dönem esnekliği) hesaplanması.
coef(model)[[2]]

# Uzun dönem çarpanının (uzun dönem esnekliği) hesaplanması.
coef(model)[[2]] + coef(model)[[3]] + coef(model)[[4]] + coef(model)[[5]] + coef(model)[[6]]

# Hipotez Testi 1: linearHypothesis fonksiyonu ile modelin istatistiki olarak genel anlamlılığının testi.
linearHypothesis(model, c("log(gnp) = 0", "L(log(gnp), 1) = 0", "L(log(gnp), 2) = 0", "L(log(gnp), 3) = 0", "L(log(gnp), 4) = 0"))
# linearHypothesis(model, coef.names[grep("gnp", coef.names)]) ## Yukarıdaki sonucun aynısını verir.

# Hipotez Testi 2: linearHypothesis fonksiyonu ile tüm gecikmeli değişken parametrelerinin birlikte istatistiki olarak anlamlı olup olmadığının testi.
linearHypothesis(model, c("L(log(gnp), 1) = 0", "L(log(gnp), 2) = 0", "L(log(gnp), 3) = 0", "L(log(gnp), 4) = 0")) ## p-değeri %5 anlamlılık düzeyinden büyük olduğundan boş hipotez reddedilemez ve statik model kullanılmalıdır.
# linearHypothesis(model, coef.names[grep("L", coef.names)]) ## Yukarıdaki sonucun aynısını verir.
```

# Kukla Değişkenler {#Dummy.Variables}
- Bu alt bölümde, zaman serileri modellerinde kukla değişkenler **iki basit zaman serisi modeli** kullanılarak uygulamalı olarak gösterilecektir.
    + Statik Modeller
    + Sonlu Dağıtılmış Gecikme Modelleri (Finite Distributed Lag Models) - FDL Modelleri

## Örnek: 1 {#Dummy.Variables.Example.1}
- Örnek olarak, `wooldridge` R paketinden `fertil3` verisini yükleyelim.
- `fertil3` verisi genel olarak Amerika'daki **doğurganlık, vergi muafiyeti, savaş ve doğum kontrol hapı** değişkenlerini, ve ayrıca bu değişkenlere ait gecikme ve ilk farklar değerlerini yıllık olarak içeriyor. Örneğimizi basitleştirmek için biz sadece bazı değişkenleri kullanacağız.
    + gfr ($gfr_{t}$): doğurganlık oranı (doğurganlık yaşındaki 1000 kadına düşen bebek sayısı)
    + pe ($pe_{t}$): çocuk sahibi olmayı özendirmek için getirilen vergi muafiyeti ($)
    + ww2 ($ww2_{t}$): II. Dünya Savaşı yıllarını belirten kukla değişken (1941-1945 yılları için 1 diğer yıllar için 0)
    + pill ($pill_{t}$): doğum kontrol hapı kullanımının yasal olduğu yılları belirten kukla değişken (1963 ve sonrası için 1 diğer yıllar için 0)
- Daha sonra yüklediğimiz veriyi kullanarak aşağıdaki statik modeli tahmin edelim.
    + Model (Statik): $gfr_{t} = \beta_{0} + \beta_{1}pe_{t} + \beta_{2}ww2_{t} + \beta_{3}pill_{t} + u_{t}$
- Son olarak model tahminini kullanarak aşağıdaki hipotezleri [`car`](https://cran.r-project.org/web/packages/car/index.html) R paketindeki `linearHypothesis` fonksiyonuyla test edelim.
    + Hipotez Testi 1 (Çift Kuyruk $t$-testi): $H_{0}: \beta_{1} = 0 \;\; \text{vs.} \;\; H_{1}: \beta_{1} \neq 0$
    + Hipotez Testi 2 (Çift Kuyruk $t$-testi): $H_{0}: \beta_{2} = 0 \;\; \text{vs.} \;\; H_{1}: \beta_{2} \neq 0$
    + Hipotez Testi 3 (Çift Kuyruk $t$-testi): $H_{0}: \beta_{3} = 0 \;\; \text{vs.} \;\; H_{1}: \beta_{3} \neq 0$
    + Modelin istatistiki olarak genel anlamlılığının testi.
        * Hipotez Testi 4 ($F$-testi): $H_{0}: \beta_{1} = \beta_{2} = \beta_{3} = 0 \;\; \text{vs.} \;\; H_{1}: H_{0} \ \text{doğru değil}$
```{r Dummy.Variables.Example.1}
data(fertil3) ## Datayı yüklüyoruz.
?fertil3 ## Datanın metadatası.

data <- fertil3 ## Yüklediğimiz datayı "data" ismi ile kaydediyoruz.

# Bazı değişkenlere ait önemli değerler.
min(data$gfr); max(data$gfr)
min(data$pe); max(data$pe); mean(data$pe)

# Model : Doğurganlık, vergi muafiyeti, savaş ve doğurganlık hapı arasındaki statik model.
model <- lm(data = data, formula = gfr ~ pe + ww2 + pill, singular.ok = FALSE)
summary(model) ## Tahmin özeti.

# Hipotez Testi 1: linearHypothesis fonksiyonu ile Beta1 için çift kuyruklu t-testi.
linearHypothesis(model, c("pe = 0"))

# Hipotez Testi 2: linearHypothesis fonksiyonu ile Beta2 için çift kuyruklu t-testi.
linearHypothesis(model, c("ww2 = 0"))

# Hipotez Testi 3: linearHypothesis fonksiyonu ile Beta3 için çift kuyruklu t-testi.
linearHypothesis(model, c("pill = 0"))

# Hipotez Testi 4: linearHypothesis fonksiyonu ile modelin istatistiki olarak genel anlamlılığının testi.
linearHypothesis(model, c("pe = 0", "ww2 = 0", "pill = 0"))
```

## Örnek: 2 {#Dummy.Variables.Example.2}
- Örnek olarak, `wooldridge` R paketinden `fertil3` verisini yükleyelim.
- `fertil3` verisi genel olarak Amerika'daki **doğurganlık, vergi muafiyeti, savaş ve doğum kontrol hapı** değişkenlerini, ve ayrıca bu değişkenlere ait gecikme ve ilk farklar değerlerini yıllık olarak içeriyor. Örneğimizi basitleştirmek için biz sadece bazı değişkenleri kullanacağız.
    + gfr ($gfr_{t}$): doğurganlık oranı (doğurganlık yaşındaki 1000 kadına düşen bebek sayısı)
    + pe ($pe_{t}$): çocuk sahibi olmayı özendirmek için getirilen vergi muafiyeti ($)
    + ww2 ($ww2_{t}$): II. Dünya Savaşı yıllarını belirten kukla değişken (1941-1945 yılları için 1 diğer yıllar için 0)
    + pill ($pill_{t}$): doğum kontrol hapı kullanımının yasal olduğu yılları belirten kukla değişken (1963 ve sonrası için 1 diğer yıllar için 0)
- Daha sonra yüklediğimiz veriyi kullanarak aşağıdaki FDL$_{(2)}$ modelini tahmin edelim.
    + Model 1 (FDL$_{(2)}$): $gfr_{t} = \alpha_{0} + \delta_{0}pe_{t} + \delta_{1}pe_{t-1} + \delta_{2}pe_{t-2} + \beta_{1}ww2_{t} + \beta_{2}pill_{t} + u_{t}$
- Daha sonra Model 1 tahminini kullanarak aşağıdaki hipotezleri [`car`](https://cran.r-project.org/web/packages/car/index.html) R paketindeki `linearHypothesis` fonksiyonuyla test edelim.
    + $pe$ bağımsız değişkenlerinin beraberce istatistiki anlamlılığının testi.
        * Hipotez Testi 1 ($F$-testi): $H_{0}: \delta_{0} = \delta_{1} = \delta_{2} = 0 \;\; \text{vs.} \;\; H_{1}: H_{0} \ \text{doğru değil}$
    + Tüm gecikmeli değişken parametrelerinin birlikte istatistiki olarak anlamlı olup olmadığının testi.
        * Hipotez Testi 2 ($F$-testi): $H_{0}: \delta_{1} = \delta_{2} = 0 \;\; \text{vs.} \;\; H_{1}: H_{0} \ \text{doğru değil}$
        * Eğer boş hipotez reddedilirse, FDL$_{(2)}$ modeline ihtiyaç vardır. Aksi durumda statik model kullanılmalıdır.
- Daha sonra Model 1 tahminini kullanarak uzun dönem çarpanı değerini hesaplayalım.
    + Uzun dönem çarpanı: $\hat{\theta}_{0} = \hat{\delta}_{0} + \hat{\delta}_{1} + \hat{\delta}_{2}$
- Daha sonra uzun dönem çarpanının istatistiki anlamlılığını test etmek için Model 1'i dönüştürüp Model 2'yi oluşturalım.
    + Model 2 (FDL$_{(2)}$): $gfr_{t} = \alpha_{0} + \theta_{0}pe_{t} + \delta_{1}(pe_{t-1} - pe_{t}) + \delta_{2}(pe_{t-2} - pe_{t}) + \beta_{1}ww2_{t} + \beta_{2}pill_{t} + u_{t}$
    + Model 2'nin çıkarılışı için ders slaytlarına bakabilirsiniz.
- Daha sonra Model 2 tahminini kullanarak uzun dönem çarpanı $\theta_{0}$'nın istatistiki anlamlılığını test edelim.
    + Hipotez Testi 3 (Çift Kuyruk $t$-testi): $H_{0}: \theta_{0} = 0 \;\; \text{vs.} \;\; H_{1}: \theta_{0} \neq 0$
- Son olarak Model 2 tahminini kullanarak uzun dönem çarpanı $\theta_{0}$ için %95'lik güven aralığını hem `confint` fonksiyonunu kullanarak hem de elle hesaplayalım.
    + $\theta_{0}$ için %95'lik güven aralığı tahmini: $[\hat{\theta}_{0} - c \cdot se(\hat{\theta}_{0}), \; \hat{\theta}_{0} + c \cdot se(\hat{\theta}_{0})]$
        * Burada, $c = t_{(1 - \alpha/2), \; sd} = t_{0.975, \; n-k-1}$'dır.
```{r Dummy.Variables.Example.2}
data(fertil3) ## Datayı yüklüyoruz.
?fertil3 ## Datanın metadatası.

data <- fertil3 ## Yüklediğimiz datayı "data" ismi ile kaydediyoruz.
data.ts <- ts(data, start = 1913) ## Data 1913 yılından itibaren başlamış.

# Model 1 : Doğurganlık, vergi muafiyeti, savaş ve doğurganlık hapı arasındaki FDL(2) modeli.
model.1 <- dynlm(data = data.ts, formula = gfr ~ pe + L(pe, 1) + L(pe, 2) + ww2 + pill, singular.ok = FALSE)
summary(model.1) ## Tahmin özeti.

# Cari ve gecikmeli pe değerleri arasındaki korelasyon.
cor(data$pe, data$pe_1, use = "complete.obs", method = c("pearson"))
cor(data$pe, data$pe_2, use = "complete.obs", method = c("pearson"))
cor(data$pe_1, data$pe_2, use = "complete.obs", method = c("pearson"))

# Hipotez Testi 1 (Model 1): linearHypothesis fonksiyonu ile cari ve gecikmeli dönemdeki pe değişkenlerinin beraberce istatistiki anlamlılığının testi.
linearHypothesis(model.1, c("pe = 0", "L(pe, 1) = 0", "L(pe, 2) = 0"))

# Hipotez Testi 2 (Model 1): linearHypothesis fonksiyonu ile tüm gecikmeli değişken parametrelerinin birlikte istatistiki olarak anlamlı olup olmadığının testi.
linearHypothesis(model.1, c("L(pe, 1) = 0", "L(pe, 2) = 0")) ## p-değeri %5 anlamlılık düzeyinden büyük olduğundan boş hipotez reddedilemez ve statik model kullanılmalıdır.

# Model 1 tahmini kullanılarak uzun dönem çarpanının hesaplanması.
coef(model.1)[[2]] + coef(model.1)[[3]] + coef(model.1)[[4]]

# Model 2 : Doğurganlık, vergi muafiyeti, savaş ve doğurganlık hapı arasındaki FDL(2) modelinin (Model 1) uzun dönem çarpanını hesaplamak için dönüştürülmüş hali.
model.2 <- dynlm(data = data.ts, formula = gfr ~ pe + I(L(pe, 1) - pe) + I(L(pe, 2) - pe) + ww2 + pill, singular.ok = FALSE) ## Burada [pe(t-1) - pe(t)] bağımsız değişkeni modele koyabilmek için I() fonksiyonunu kullandığımıza dikkat edin.
summary(model.2) ## Tahmin özeti.

# Hipotez Testi 3 (Model 2): hoCoef fonksiyonu ile çift ve tek kuyruklu t-testi.
hoCoef(model.2, term = 2, bo = 0, alt = c("two.sided")) ## Çift kuyruklu t-testi: H0: Theta0 = 0 vs H1: Theta0 != 0 
linearHypothesis(model.1, c("pe + L(pe, 1) + L(pe, 2) = 0")) ## Model 1'i dönüştürmeden direkt olarak Model 1'in sonuçlarını kullanarak uzun dönem çarpanı 

# Uzun dönem çarpanı için %95'lik güven aralığı (%5 anlamlılık düzeyinde) hesaplanması.
conf.level <- 0.95
alpha <- 1 - conf.level

## confint fonksiyonu ile güven aralığı hesaplanması.
confint(object = model.2, parm = "pe", level = conf.level)

## Elle güven aralığı hesaplanması.
estimate.beta <- coef(summary(model.2))[2, 1] ## Parametre tahmini
estimate.se <- coef(summary(model.2))[2, 2] ## Parametre için standart hata tahmini.
t.critic <- qt(p = (1 - alpha/2), df = model.2$df.residual, lower.tail = TRUE, log.p = FALSE) ## t-kritik değeri.
estimate.beta - (t.critic * estimate.se) ## Güven aralığı alt limiti.
estimate.beta + (t.critic * estimate.se) ## Güven aralığı üst limiti.
```

# Trend {#Trend}
- Bu alt bölümde, zaman serileri analizinde trende sahip değişkenlerin regresyonda kullanımı iki farklı yöntem ve **statik zaman serisi modeli** kullanılarak uygulamalı olarak gösterilecektir.
    + Trend Değişkeni Eklenmesi
    + Trendin Berteraf Edilmesi
- Trende sahip değişkenler FDL modellerinde de aynı statik modellerdeki gibi kullanılabilir, fakat burada gösterilmemiştir.

## Trend Değişkeni Eklenmesi {#Trend.Variable}
### Örnek: 1 {#Trend.Variable.Example.1}
- Örnek olarak, `wooldridge` R paketinden `hseinv` verisini yükleyelim.
- `hseinv` verisi genel olarak Amerika'daki **ev yatırımları ve fiyatlar** değişkenlerini, ve ayrıca bu değişkenlere ait gecikme ve ilk farklar değerlerini yıllık olarak içeriyor. Örneğimizi basitleştirmek için biz sadece bazı değişkenleri kullanacağız.
    + invpc ($invpc_{t}$): reel kişi başı ev yatırımı (bin dolar)
    + price ($price_{t}$): ev fiyatları indeksi (1982 baz yılı = 1)
    + t ($t$): zaman trendi
- Sonra yüklediğimiz bu verinin metadatasını ve yapısını inceleyelim.
- Daha sonra yüklediğimiz veriyi kullanarak aşağıdaki statik modeli tahmin edelim.
    + Model 1 (Statik): $\ln(invpc_{t}) = \beta_{0} + \beta_{1}\ln(price_{t}) + u_{t}$
- Daha sonra Model 1 tahminini kullanarak aşağıdaki hipotezleri `hoCoef` fonksiyonuyla test edelim.
    + Hipotez Testi 1 (Çift Kuyruk $t$-testi): $H_{0}: \beta_{1} = 0 \;\; \text{vs.} \;\; H_{1}: \beta_{1} \neq 0$
    + Hipotez Testi 2 (Çift Kuyruk $t$-testi): $H_{0}: \beta_{1} = 1 \;\; \text{vs.} \;\; H_{1}: \beta_{1} \neq 1$
- Daha sonra Model 1'de kullandığımız bağımlı ve bağımsız değişkenlerde trend olup olmadığını anlamak için bu değişkenleri trend ($t$) üzerine regres edip aşağıdaki modelleri tahmin edelim.
    + Model 2 (Statik): $\ln(invpc_{t}) = \alpha_{0} + \alpha_{1}t + \epsilon_{t}$
    + Model 3 (Statik): $\ln(price_{t}) = \alpha_{0} + \alpha_{1}t + \epsilon_{t}$
- Daha sonra Model 2 ve Model 3'deki trend değişkenine ait parametrelerin istatistiki olarak anlamlı olup olmadığını model tahmin sonuçlarını kullanarak bulmaya ve sonuç olarak Model 1'de kullanılan bağımlı ve bağımsız değişkenlerde trend olup olmadığına karar vermeye çalışalım.
- Daha sonra Model 1'deki bağımlı ve bağımsız değişkenlerde trend bulunduğundan dolayı **sahte regresyon problemi** ile karşılaşmamak için trend değişkeni eklenmiş aşağıdaki statik modeli tahmin edelim.
    + Model 4 (Trendli Statik): $\ln(invpc_{t}) = \beta_{0} + \beta_{1}\ln(price_{t}) + \beta_{2}t + u_{t}$
        * Model 4 Log-Log fonksiyonel formunda olduğundan trende ait $\beta_{2}$ parametresi bağımlı değişken $invpc_{t}$'deki büyüme oranını ifade edecektir. Yani, üstel trend modeli kullanılmıştır.
- Son olarak Model 4 tahminini kullanarak aşağıdaki hipotezleri `hoCoef` fonksiyonuyla test edelim.
    + Hipotez Testi 3 (Çift Kuyruk $t$-testi): $H_{0}: \beta_{1} = 0 \;\; \text{vs.} \;\; H_{1}: \beta_{1} \neq 0$
    + Hipotez Testi 4 (Çift Kuyruk $t$-testi): $H_{0}: \beta_{2} = 0 \;\; \text{vs.} \;\; H_{1}: \beta_{1} \neq 0$
```{r Trend.Variable.Example.1}
data(hseinv) ## Datayı yüklüyoruz.
?hseinv ## Datanın metadatası.

data <- hseinv ## Yüklediğimiz datayı "data" ismi ile kaydediyoruz.
str(data) ## Datanın yapısını inceleyelim.
data ## Datanın yapısını inceleyelim.

# Model 1: Ev yatırımları ve fiyatları arasındaki trendsiz statik model.
model.1 <- lm(data = data, formula = log(invpc) ~ log(price), singular.ok = FALSE)
summary(model.1) ## Tahmin özeti.

# Hipotez Testi 1 (Model 1): hoCoef fonksiyonu ile çift ve tek kuyruklu t-testi.
hoCoef(model.1, term = 2, bo = 0, alt = c("two.sided")) ## Çift kuyruklu t-testi: H0: Beta1 = 0 vs H1: Beta1 != 0

# Hipotez Testi 2 (Model 1): hoCoef fonksiyonu ile çift ve tek kuyruklu t-testi.
hoCoef(model.1, term = 2, bo = 1, alt = c("two.sided")) ## Çift kuyruklu t-testi: H0: Beta1 = 1 vs H1: Beta1 != 1

# Model 2: Ev yatırımları değişkeni trend üzerine regres ediliyor.
model.2 <- lm(data = data, formula = log(invpc) ~ t, singular.ok = FALSE)
summary(model.2) ## Tahmin özeti.

# Model 3: Fiyatlar değişkeni trend üzerine regres ediliyor.
model.3 <- lm(data = data, formula = log(price) ~ t, singular.ok = FALSE)
summary(model.3) ## Tahmin özeti.

# Model 4: Ev yatırımları ve fiyatları arasındaki trendli statik model.
model.4 <- lm(data = data, formula = log(invpc) ~ log(price) + t, singular.ok = FALSE)
summary(model.4) ## Tahmin özeti.

# Hipotez Testi 3 (Model 4): hoCoef fonksiyonu ile çift ve tek kuyruklu t-testi.
hoCoef(model.4, term = 2, bo = 0, alt = c("two.sided")) ## Çift kuyruklu t-testi: H0: Beta1 = 0 vs H1: Beta1 != 0

# Hipotez Testi 4 (Model 4): hoCoef fonksiyonu ile çift ve tek kuyruklu t-testi.
hoCoef(model.4, term = 3, bo = 0, alt = c("two.sided")) ## Çift kuyruklu t-testi: H0: Beta2 = 0 vs H1: Beta2 != 0
```

### Örnek: 2 {#Trend.Variable.Example.2}
- Örnek olarak, `wooldridge` R paketinden `fertil3` verisini yükleyelim.
- `fertil3` verisi genel olarak Amerika'daki **doğurganlık, vergi muafiyeti, savaş ve doğum kontrol hapı** değişkenlerini, ve ayrıca bu değişkenlere ait gecikme ve ilk farklar değerlerini yıllık olarak içeriyor. Örneğimizi basitleştirmek için biz sadece bazı değişkenleri kullanacağız.
    + gfr ($gfr_{t}$): doğurganlık oranı (doğurganlık yaşındaki 1000 kadına düşen bebek sayısı)
    + pe ($pe_{t}$): çocuk sahibi olmayı özendirmek için getirilen vergi muafiyeti ($)
    + ww2 ($ww2_{t}$): II. Dünya Savaşı yıllarını belirten kukla değişken (1941-1945 yılları için 1 diğer yıllar için 0)
    + pill ($pill_{t}$): doğum kontrol hapı kullanımının yasal olduğu yılları belirten kukla değişken (1963 ve sonrası için 1 diğer yıllar için 0)
    + t ($t$): zaman trendi
- Daha sonra yüklediğimiz veriyi kullanarak aşağıdaki karesel trendli statik modeli tahmin edelim.
    + Model (Statik): $gfr_{t} = \beta_{0} + \beta_{1}pe_{t} + \beta_{2}ww2_{t} + \beta_{3}pill_{t} + \beta_{4}t + \beta_{5}t^{2} + u_{t}$
```{r Trend.Variable.Example.2}
data(fertil3) ## Datayı yüklüyoruz.
?fertil3 ## Datanın metadatası.

data <- fertil3 ## Yüklediğimiz datayı "data" ismi ile kaydediyoruz.

# Model : Doğurganlık, vergi muafiyeti, savaş ve doğurganlık hapı arasındaki karesel trendli statik model.
model <- lm(data = data, formula = gfr ~ pe + ww2 + pill + t + I(t^2), singular.ok = FALSE) ## Burada t^2 bağımsız değişkeni modele koyabilmek için I() fonksiyonunu kullandığımıza dikkat edin.
summary(model) ## Tahmin özeti.
```

## Trendin Berteraf Edilmesi {#Detrending.Example}
- Örnek olarak, `wooldridge` R paketinden `hseinv` verisini yükleyelim.
- `hseinv` verisi genel olarak Amerika'daki **ev yatırımları ve fiyatlar** değişkenlerini, ve ayrıca bu değişkenlere ait gecikme ve ilk farklar değerlerini yıllık olarak içeriyor. Örneğimizi basitleştirmek için biz sadece bazı değişkenleri kullanacağız.
    + invpc ($invpc_{t}$): reel kişi başı ev yatırımı (bin dolar)
    + price ($price_{t}$): ev fiyatları indeksi (1982 baz yılı = 1)
    + t ($t$): zaman trendi
- Daha sonra yüklediğimiz veriyi kullanarak aşağıdaki trendli statik modeli tahmin edelim.
    + Model 1 (Trendli Statik): $\ln(invpc_{t}) = \beta_{0} + \beta_{1}\ln(price_{t}) + \beta_{2}t + u_{t}$
        * Model 1 Log-Log fonksiyonel formunda olduğundan trende ait $\beta_{2}$ parametresi bağımlı değişken $invpc_{t}$'deki büyüme oranını ifade edecektir. Yani, üstel trend modeli kullanılmıştır.
        * Not: Bağımlı ve bağımsız değişkenlerde trend bulunduğundan dolayı **sahte regresyon problemi** ile karşılaşmamak için Model 1'e trend eklenmiştir. Bakınız [Trend Değişkeni Eklenmesi: Örnek 1](#Trend.Variable.Example.1)
- Daha sonra Model 1'de kullanılan bağımlı ve bağımsız değişkenleri trend değişkeni üzerine ayrı ayrı regres edip her modelden elde edilen kalıntıları ($\overset{..}{y}_{t}$ ve $\overset{..}{x}_{1t}$ gibi) hesaplayalım. Yani, tüm değişkenlerdeki trendi berteraf edelim.
    + Model 2: $\ln(invpc_{t}) = \alpha_{0} + \alpha_{1}t + e_{t} \quad \longrightarrow \quad \hat{e}_{t} = ln(invpc_{t}) - \widehat{\ln(invpc_{t})}$
    + Model 3: $\ln(price_{t}) = \theta_{0} + \theta_{1}t + h_{t} \quad \longrightarrow \quad \hat{h}_{t} = ln(price_{t}) - \widehat{\ln(price_{t})}$
- Daha sonra Model 2 ve Model 3'den elde edilen artıkları birbiri üzerine regres edip aşağıdaki modeli tahmin edelim.
    + Model 4 (Trendsiz Statik): $\hat{e}_{t} = \delta_{0} + \delta_{1}\hat{h}_{t} + u_{t}$
- Son olarak Model 1 ve Model 4 sonuçlarının aynı olup olmadığını inceleyelim.
```{r Detrending.Example}
data(hseinv) ## Datayı yüklüyoruz.
?hseinv ## Datanın metadatası.

data <- hseinv ## Yüklediğimiz datayı "data" ismi ile kaydediyoruz.

# Model 1: Ev yatırımları ve fiyatları arasındaki trendli statik model.
model.1 <- lm(data = data, formula = log(invpc) ~ log(price) + t, singular.ok = FALSE)
summary(model.1) ## Tahmin özeti.

#===
# Ek bilgi: Statik modeli dynlm() fonksiyonu ile tahmin etmek.
data.ts <- ts(data, start = 1947) ## Data 1947 yılından itibaren başlamış.
model.1 <- dynlm(data = data.ts, formula = log(invpc) ~ log(price) + trend(data.ts), singular.ok = FALSE) ## dynlm() fonksiyonu statik modeller için de kullanılabilir. dynlm() fonksiyonunun avantajı data içinde trend ya da mevsimsellik değişkenleri olmasa da otomatik olarak oluşturabilmesidir. trend() fonksiyonu kullanarak modele lineer trend eklenebilir.
summary(model.1) ## Tahmin özeti. Yukarıdaki lm() fonksiyonu ile elde edilen sonucun aynısı.
#===

# Model 2: Ev yatırımları ve trend arasındaki model.
model.2 <- lm(data = data, formula = log(invpc) ~ t, singular.ok = FALSE)
ln.invpc.resid <- model.2$residuals ## Kalıntılar.

# Model 3: Fiyatlar ve trend arasındaki model.
model.3 <- lm(data = data, formula = log(price) ~ t, singular.ok = FALSE)
ln.price.resid <- model.3$residuals ## Kalıntılar.

model.4 <- lm(formula = ln.invpc.resid ~ ln.price.resid, singular.ok = FALSE) ## Data argumanını kullanmadıgımıza ve aynı uzunlukta iki değişken kullandığımıza dikkat edin.
summary(model.4) ## Tahmin özeti.

# Model 1 ve Model 4 arasında karşılaştırma yapmak amacıyla stargazer fonksiyonu kullanılıyor.
stargazer(model.1, model.4, type = "text")
```

# Mevsimsellik {#Seasonality}
- Bu alt bölümde, zaman serileri analizinde mevsimselliğe sahip değişkenlerin regresyonda kullanımı bir yöntem ve **statik zaman serisi modeli** kullanılarak uygulamalı olarak gösterilecektir.
    + Mevsimsel Kukla Değişkenlerin Eklenmesi
- Mevsimselliğe sahip değişkenler FDL modellerinde de aynı statik modellerdeki gibi kullanılabilir, fakat burada gösterilmemiştir.

## Mevsimsel Kukla Değişkenlerin Eklenmesi {#Seasonal.Dummy.Variables.Example}
- Örnek olarak, [`AER`](https://cran.r-project.org/web/packages/AER/index.html) R paketinden `USMoney` verisini yükleyelim.
- `USMoney` verisi genel olarak Amerika'daki **para arzı ve GSMH** değişkenlerini çeyreklik olarak içeriyor. Örneğimizi basitleştirmek için biz sadece bazı değişkenleri kullanacağız.
    + m1 ($m1_{t}$): Para Arzı (Para Stoğu M1)
    + gnp ($gnp_{t}$): Nominal Gayri Safi Milli Hasıla (GSMH)
- Daha sonra yüklediğimiz veriyi kullanarak GSMH'nin para arzı üzerindeki etkisini araştıran Log-Log fonksiyonel formundaki trendli ve mevsimsel kuklalı statik modeli tahmin edelim.
    + Model (Trendli ve Mevsimsel KuklalıStatik): $\ln(m1_{t}) = \beta_{0} + \beta_{1}\ln(gnp_{t}) + \beta_{2}t + \delta_{1}Q2_{t} + \delta_{2}Q3_{t} + \delta_{3}Q4_{t} + u_{t}$
        * Model Log-Log fonksiyonel formunda olduğundan trende ait $\beta_{2}$ parametresi bağımlı değişken $m1_{t}$'deki büyüme oranını ifade edecektir. Yani, üstel trend modeli kullanılmıştır.
        * Çeyrek 1'i ifade eden $Q1_{t}$ baz dönem olarak alınmıştır ve bu nedenle modelde yoktur.
        * Çeyrek 1'in $\ln(m1_{t})$ üzerindeki etkisini sabit terim $\beta_{0}$ ifade eder.
- Son olarak model tahminini kullanarak aşağıdaki hipotezleri
[`car`](https://cran.r-project.org/web/packages/car/index.html) R paketindeki `linearHypothesis` fonksiyonuyla test edelim.
    + Tüm mevsimsel kukla değişken parametrelerinin birlikte istatistiki olarak anlamlı olup olmadığının testi.
        * Hipotez Testi 1 ($F$-testi): $H_{0}: \delta_{1} = \delta_{2} = \delta_{3} = 0 \;\; \text{vs.} \;\; H_{1}: H_{0} \ \text{doğru değil}$
        * Eğer boş hipotez reddedilirse, $\ln(m1_{t})$'de ve dolayısıyla modelde mevsimsellik vardır, yani mevsimsel kukla değişkenlere ihtiyaç vardır. Aksi durumda mevsimsel kukla değişkenler kullanılmamalıdır.
```{r #Seasonal.Dummy.Variables.Example}
data(USMoney) ## Datayı yüklüyoruz.
?USMoney ## Datanın metadatası.

data.ts <- USMoney ## Yüklediğimiz datayı "data" ismi ile kaydediyoruz. Yüklediğimiz datanın ts yani zaman serisi objesi olduğunu unutmayın.

# Amerika'daki GSMH'nin para arzı üzerindeki etkisini araştıran trendli ve mevsimsel kuklalı statik modeli.
model <- dynlm(data = data.ts, formula = log(m1) ~ log(gnp) + trend(data.ts) + season(data.ts), singular.ok = FALSE) ## dynlm() fonksiyonu statik modeller için de kullanılabilir. dynlm() fonksiyonunun avantajı data içinde trend ya da mevsimsellik değişkenleri olmasa da otomatik olarak oluşturabilmesidir. trend() fonksiyonu kullanarak modele lineer trend eklenebilir. season() fonksiyonu kullanarak modele mevsimsel kukla değişkenleri eklenebilir (ilk dönem, baz dönem olacaktır).
summary(model) ## Tahmin özeti.

# Parametre isimleri daha sonra kullanılmak üzere kaydediliyor.
coef.names <- names(coef(model))

# Hipotez Testi 1: linearHypothesis fonksiyonu ile tüm mevsimsel kukla değişken parametrelerinin birlikte istatistiki olarak anlamlı olup olmadığının testi.
linearHypothesis(model, c("season(data.ts)Q2 = 0", "season(data.ts)Q3 = 0", "season(data.ts)Q4 = 0")) ## p-değeri %5 anlamlılık düzeyinden büyük olduğundan boş hipotez reddedilemez ve mevsimsel kukla değişkenler kullanılmamalıdır.
linearHypothesis(model, coef.names[grep("season", coef.names)]) ## Yukarıdaki sonucun aynısını verir.
```

<!-- ================================ SON ================================== -->
